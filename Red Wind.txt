http://indiewebcamp.com/Red_Wind

== Description ==
[[User:kylewm.com]]'s Red Wind ([http://git.kylewm.com/?p=redwind.git;a=summary source code]) is IndieWebified blog software written in Python and running on Flask. It is intended to be clean, lightweight, and amenable to experimentation. Red Wind is open source but unstable and undocumented and probably not of much use to anyone but the author, at least for now.

== Features ==
* send and receives webmentions (processed asynchronously using uWSGI's spooler)
* send PuSH notifications for new posts
* syndicates to Facebook and Twitter via their snowflake APIs
* backfeeds comments via [[Bridgy]]
* reply/like/share context automatically fetched after posting
* optional geo-location information for posts.
* as of 2014-03-29, switched from SQLAlchemy/MySQL to flat files (thanks to [[databases_antipattern]])
** 1 file per article/note/share/etc. named _data/posts/year/month/day/posttype_index.format
** post is formatted in markdown. Each file starts with a json blob for metadata. 
** The source urls of received (and verified) webmentions are stored alongside each post, in a file named posttype_index.mentions.json 
** mentions and reply contexts are stored together in a separate archive directory, loosely modeled on [[IndieArchive]].

The name comes from Raymond Chandler's short story of the same name, about the Santa Ana winds that drive everyone crazy :)

== Filestore ==

Each post is represented in markdown, with one json blob in the header for metadata. e.g.,

<pre>
{
  "hidden": true, 
  "syndication": {
    "twitter_id": "460635803253612544"
  }, 
  "pub_date": "2014-04-28T04:24:06", 
  "in_reply_to": [
    "http://kylewm.com/note/2014/04/28/1", 
    "https://twitter.com/courtarro/status/460629961557041152"
  ]
}
@courtarro thanks, gitweb's good enough for now. it's too bad the other OS options are in RoR; reaaaally trying to avoid learning that stack :P
</pre>

Posts are stored in flat files, organized by <code>[post-type]/[year]/[month]/[newbase60 index].md</code>. Responses are stored in a parallel file called <code>[newbase60 index].mentions.json</code> in the same directory. Right now mentions just contains a list of URLs.

To support paging and eventually, tags and other lookups, post metadata is cached in a file called, what else, <code>metadata.json</code>. The metadata file contains a list of all posts, and the 30 most recent mentions.

<pre>
{
 "mentions": [
  {
   "post": "note/2014/04/28/4",
   "mention": "https://brid-gy.appspot.com/like/twitter/kyle_wm/460918876574711808/11628"
  },
  {
   "post": "note/2014/04/28/2",
   "mention": "http://kylewm.wordpress.com/2014/04/28/test-sending-a-pingback/"
  },
  ...
  ],
 "posts": [
  {
   "draft": false,
   "published": "2013-06-18T00:00:00",
   "deleted": false,
   "path": "article/2013/06/18/1",
   "hidden": false,
   "type": "article"
  },
  {
   "draft": false,
   "published": "2013-07-30T00:00:00",
   "deleted": false,
   "path": "article/2013/07/30/1",
   "hidden": false,
   "type": "article"
  },
  ...
  ]
}
</pre>

The datastore is mirrored in a private repo on git.kylewm.com, though it lags behind the live data somewhat

== Address Book ==

Red Wind has basic support for referring to other people by name. Currently, this feature is called an "address book", but I'm considering more timely alternatives[http://indiewebcamp.com/irc/2014-07-07#t1404777277]

When entering a new person in the book, I put their URL in the first field and click "Fetch Profile". If they publish an h-card on their site, it will try to extract their name, photo, and twitter/facebook usernames and fill the rest of the fields automatically.

[[File:kylewm-addressbook-2014-07-07.png|none|thumb|500px|Entering a new address]]

Right now I tag people using MediaWiki inspired syntax: <nowiki>[[Ben Werdm√ºller|Ben]]</nowiki>, but am considering moving to a simpler @nickname [http://indiewebcamp.com/p3k#Local_Nicknames like p3k] uses.  

=== POSSE ===

When POSSEing to twitter, names are translated to the appropriate @-username. I tried [http://indiewebcamp.com/POSSE_to_Facebook#Mention_Tagging pretty hard] to do the same for Facebook, but their API made it difficult. Long story short, you have to apply for elevated permissions and use the Actions & Objects API whose future seems uncertain.

An original note tagging three people

[[File:kylewm-reply-tagging-people-2014-07-07.png|none|thumb|500px|Original post with mentions]]

The POSSE copy with their Twitter usernames

[[File:kylewm-twitter-tagged-people.png|none|thumb|500px|POSSEd copy with twitter usernames]]

=== Storage format === 

Names are stored in a JSON dict, indexed by full name (generally the p-name on their h-card if they publish one)
 
<code><pre>
{
 "Kartik Prabhu": {
  "twitter": "kartik_prabhu", 
  "facebook": "", 
  "url": "https://kartikprabhu.com/about", 
  "photo": "http://lh3.googleusercontent.com/-r3A9y0QWUGA/T4XzCE5BhCI/AAAAAAAAPRU/zAXHDpcuuqg/s300/Recursion-small.jpg"
 }, 
 "David Shanske": {
  "twitter": "dshanske", 
  "facebook": "dshanske", 
  "url": "https://david.shanske.com", 
  "photo": "http://david.shanske.com/wp-content/uploads/2014/03/me-head.png"
 }, 
 "gRegor Morrill": {
  "twitter": "gRegorLove", 
  "facebook": "", 
  "url": "http://gregorlove.com", 
  "photo": "http://gregorlove.com/assets/img/profile.jpg"
 }, 
 ...
</pre></code>

== Screenshots ==

Interface for posting a reply as of 2014-03-24

[[File:kwm-posting-interface-2014-03-24.png|none|thumb|500px|Original posting interface]]

The interface for posting replies has been simplified quite a bit, with AJAXy status update stuff removed as of 2014-04-29

[[File:kwm-posting-interface-2014-04-29.png|none|thumb|500px|Everything happens in a on an async queue now, so no more live updates]]

2014-07, moved logic out of templates to support switchable themes, added new theme based on [http://www.getskeleton.com/ Skeleton]

[[File:kylewm-redesign-2014-07-05.png|none|thumb|500px|Skeleton-based redesign]]

The sidebar reorients for small screens

[[File:kylewm-redesign-mobile-2014-07-05.png|none|thumb|500px|Redesign on a small screen]]

Interface for posting new notes, with clickable list of recent tags

[[File:kylewm-tag-speedbar-2014-07-15.gif]]
